<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta content="width=device-width, initial-scale=1.0"
        name="viewport">
  <meta content="ie=edge"
        http-equiv="X-UA-Compatible">
  <title>Todo App</title>
  <style>
    .hidden {
        display: none;
    }
  </style>
</head>
<body>
  <ul id='todos'>
    <form id='form'
          name="form">
      <input id='description'
            name='description'
            type='text'> <input name='submit'
            type='submit'
            value='Submit todo'><br>
    </form>
    <div class="hidden"
         id='error'>
      Something went wrong
    </div>{% for d in data %}
    <li>{{ d.description }}</li>{% endfor %}
  </ul>
  <script>
    document.getElementById('form').onsubmit = (e) => {
        e.preventDefault()
        fetch('/todos/create', {
            method: 'POST',
            body: JSON.stringify({
                'description': document.getElementById('description').value
            }),
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(function(response){
            return response.json()
        })
        .then(function (jsonResponse){
            const listItem = document.createElement('LI')
            listItem.innerHTML = jsonResponse['description'];
            document.getElementById('todos').appendChild(listItem);
            document.querySelector('#error').className='hidden'
        })
        .catch(()=> {
            document.querySelector('#error').className = '';
        })
    }
  </script>
</body>
</html>
